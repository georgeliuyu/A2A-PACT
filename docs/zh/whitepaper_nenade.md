# NAS 协议（A2A‑NAS）白皮书 — Nenad 版本

副题：Trust‑Minimized · Symmetric‑Forfeit（conditional）· Timed‑Dispute

别名：曾用名 PACT（Preemptive Accountability via Escrow）
Timezone=UTC

---

## 摘要（Abstract）

从多智能体经济与“系统可控性”的角度，NAS 协议（A2A‑NAS，No‑Arbitration Settlement）以三要素——签名定价、限时争议与拉取式结算——在信任最小化前提下实现可问责与可结算的 A2A 交易。通过“对称没收（Symmetric‑Forfeit）”在对称条件下（conditional）将整蛊上界收敛为 G≤1，降低系统被廉价威胁挟持的风险。本文以 nas_spec 为规范性唯一语义源（SSOT），以 nas_game_theory 为博弈与测量的语义来源，强调可控旋钮（E_c、T_*）、分阶段开放（沙盒→对接区→全开放）、熔断/回滚的运行剧本与最小复现路径。唯一通过判据为 MET.4（G 的 P50≤1.2）；MET.5 为信息性记录；判据覆盖范围仅限 NAS 交易事件集合；比较表与决策树均为信息性工具，不纳入通过判据集。

---

## 1. 系统与控制视角（动机与边界）

### 1.1 动机

多主体环境下，交易频繁且参与方异质，任何“事后裁决/治理投票”都会成为延迟与俘获的温床。NAS 通过可验证的最小规则与公共时钟，将“社会裁决”替换为“事前承诺+可结算+可观测”的控制闭环。

### 1.2 边界（来自 nas_spec 的 A1–A8）

无仲裁/仅金额/公共时钟/拉取式结算/有界重组/可验证动作/争议期不可延长等；部署方给出 T_reorg 估计并保证 T_dis ≥ 2·T_reorg。规范判据与实现最佳实践的边界分明：前者进入“通过判据”，后者仅为“信息性”。

---

## 2. 协议简述与控制旋钮（来自 nas_spec）

### 2.1 三要素 + 状态机要点

- 签名定价（EIP‑712/1271）：任何一方可提出签名要约，对手接受后按签名定价结算（E14）。
- 限时争议（T_dis）：Disputing 态存在公共截止；超时进入 Forfeited（E15）。
- 拉取式结算（Pull）：状态变更仅记账，实际转账在提现时发生；配合幂等与去重。
- 状态机 E1–E16：Initialized/Executing/Reviewing/Disputing/Settled/Forfeited/Cancelled；锚点 startTime/readyAt/disputeStart；T_due/T_rev/T_dis（秒）。

### 2.2 可控旋钮（Knobs）

- 资金：`E_c`（可 Top‑up，单调不减）。
- 时长：`T_due/T_rev/T_dis`（相对时长，秒）。
- 行为：是否进入 Disputing；要约频率与撤销/覆盖（新要约+nonce 递增+deadline 过期）。

这些旋钮在规范层不设“全局默认”，由订单双方 per‑order 协商（见 nas_spec §2.1），保证可控性与可适配性。

---

## 3. 风险模型与运行护栏（信息性）

### 3.1 主要风险

- 廉价整蛊：极端不对称的托管/机会成本导致 G≫1 的长尾挟持（非对称条件）。
- DoS/洪峰：大量低 E_c 的争议/没收行为占用资源。
- 跨域错配：T_reorg 估计不足导致名义 T_dis 与实际安全窗口错配。

### 3.2 护栏与缓解（信息性）

- 资金/时长侧：提高最小 E_c、延长 T_dis（在合理上界内）、限制并发订单数（冷却/限流）。
- 入口侧：nonReentrant + CEI；入口前抢占 timeout*；失败重试与去重（≤3 行流程）。
- 观察侧：G 的分布与 P50 的滑窗统计；长尾争议率（信息性）作为运行信号；跨域 T_reorg 由部署方给出更新。

---

## 4. 判据与覆盖（唯一通过判据）

### 4.1 覆盖范围

仅覆盖 NAS 交易事件集合；比较表/决策树为信息性，不纳入通过判据集。

### 4.2 判据与记录

- MET.4：整蛊观测 G 的目标统计量为 P50 ≤ 1.2（唯一通过判据）。
- MET.5：阈值回归为信息性记录（price ~ E_c + T_dis，记录 R²与符号方向），不纳入通过判据。

---

## 5. 复现与抽样（统一口径）

1) 观察窗口：最近 24h；如 n<200 则扩至 7d 或至 n≥200。  
2) 抽样方法：连续窗口全量；如总量过大，系统抽样步长 k=⌈N/200⌉（N=窗口内 NAS 订单总数）。  
3) 单位统一：时间字段（含 T_dis）统一“秒”；统计以事件日志为准。  
4) 工件标识：合约地址、观察窗口起止区块、参数变更交易哈希（如有）、告警触发/通知时间戳与通知渠道标识（优先级：消息哈希 > 渠道ID > 渠道名；介质=邮件/IM/工单之一）。

---

## 6. 分阶段开放与可控性（信息性）

### 6.1 开放路径

- 阶段 1（沙盒/半封闭）：限制跨域/额度；建立基线。
- 阶段 2（对接区）：放宽限流与额度；引入外部接口（支付/钱包/桥）。
- 阶段 3（全开放）：配套治理与监测；维持最小内置。

### 6.2 运行门槛（示例）

- 成功率/争议率/没收率阈值（信息性）。
- 争议时长 P99 与 G 的 P50 稳定区间（信息性）。

---

## 7. 互操作与生态（信息性）

- EIP‑712/1271：`chainId, orderId, amountToSeller, proposer, nonce, deadline`；新要约覆盖旧要约；无“链上撤销入口”。
- 事件字段最小集：`orderId, proposer, acceptor, amountToSeller, ts`。
- ERC‑4337/AA：代付不改变 Pull 语义；信任边界在中继层。
- L2/跨域：部署方给出 T_reorg 估计与执行域配置；白皮书保持信息性说明。

---

## 8. 治理与社会层（信息性）

- 分群体诊断：G 的分布与群体差异仅作为治理输入；不改变判据。
- 社会层响应：当长窗 P50 偏离占比异常（信息性阈值）时，进入治理评审（例如上调 E_c、限流冷却、风险缓解）。

---

## 9. 结语

NAS 提供可控的多代理结算底座：以简单可审计的规则与最小判据（MET.4 P50≤1.2）形成“观测→阈值→动作”的工程闭环；其余对照、互操作与治理保持为信息性实践，遵循 Minimal Enshrinement 与 Trust‑Minimized 的原则。

---

## 附录 A：符号与术语

V/C/E_c/A/T_*，事件与状态、MET/GOV 指标，单位（时间统一“秒”）。

---

## 附录 B：Trace 示例

E10（Reviewing→Settled，timeoutSettle）→ API: `timeoutSettle` → INV.1 → EVT: `Settled` → MET: 结清率/时长。

---

## 附录 C：参考与语义来源

- 规范（SSOT）：docs/zh/nas_spec.md  
- 博弈与测量：docs/zh/nas_game_theory.md

