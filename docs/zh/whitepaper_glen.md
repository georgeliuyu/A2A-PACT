# NAS 协议（A2A‑NAS）白皮书 — Glen 版本

副题：Trust‑Minimized · Symmetric‑Forfeit（conditional）· Timed‑Dispute

别名：曾用名 PACT（Preemptive Accountability via Escrow）
Timezone=UTC

---

## 摘要（Abstract）

NAS 协议（A2A‑NAS，No‑Arbitration Settlement）在不内置社会仲裁/声誉/投票的前提下，为 A2A 场景提供一个公平、可问责、可观察的结算底座：以 “签名定价（EIP‑712/1271）+ 限时争议（T_dis）+ 拉取式结算（Pull）” 取代仲裁路径，并在对称条件下（conditional）以 “对称没收（Symmetric‑Forfeit）” 抑制廉价整蛊，保护弱势主体。协议遵循 Minimal Enshrinement 与 Credible Neutrality：仅提供可验证状态/事件与记账，不将社会裁量塞进共识。

本白皮书以 nas_spec 为规范性唯一语义源（SSOT），以 nas_game_theory 为博弈与测量的语义来源。核心保证包括：子博弈完美均衡（SPNE）、有限步终止（活性）、阈值结构（A≤V+E_c）、在对称条件下的整蛊上界（G≤1）、以及 T1–T5 变换式约束最优性。唯一通过判据为 MET.4（G 的 P50≤1.2）；MET.5（阈值回归）仅作信息性记录；判据覆盖范围仅限 NAS 交易事件集合，比较表/决策树均为信息性，不纳入通过判据集。

---

## 1. 引言（社会技术与动机）

在 A2A 生态中，参与方缺乏可用的社会裁决与身份基础设施，“中心化托管/仲裁”引入新的权力不对称与路径依赖。NAS 采用最小可验证规则替代仲裁，将“事后裁决”转化为“事前问责与可结算”，以可观察的中立性与条件下的对称性保护弱势主体，降低俘获与歧视风险。

最小不可违约束（A1–A8，见 nas_spec）：无仲裁/仅金额/公共时钟/拉取式结算/有界排序/可验证动作/争议期不可延长等。

---

## 2. 协议概览（机制与接口）

### 2.1 状态机与锚点（来自 nas_spec）

- 状态与转换：E1–E16（Initialized/Executing/Reviewing/Disputing/Settled/Forfeited/Cancelled）。
- 锚点与时长：startTime/readyAt/disputeStart；T_due/T_rev/T_dis（秒）。
- 不变量：A ≤ E_c；单次提现；Forfeited 清零；Pull 语义（INV.*）。

### 2.2 三要素（公平导向）

- 签名定价：任何一方提出签名要约，对手接受后按签名定价结算（E14）。
- 限时争议：Disputing 态的公共截止（T_dis），超时没收（E15）。
- 对称没收（Symmetric‑Forfeit，conditional）：在对称托管/机会成本近似对称时，整蛊上界 G≤1（见 §3.4）。

### 2.3 事件与日志（最小字段集，信息性）

建议事件字段：`orderId, proposer, acceptor, amountToSeller, ts`；最小披露、可审计、可回放。

---

## 3. 核心定理（来自 nas_game_theory）

### 3.1 子博弈完美均衡（SPNE）

有限期+完美信息+确定性支付/没收 → 回溯归纳（Kuhn）得到 SPNE，保证策略可预测与算法可求。

### 3.2 活性（有限步终止）

任一路径在有限真实时间内终止，上界 T_due+T_rev+T_dis；以势函数（剩余时间）证明单调递减直至终态。

### 3.3 阈值均衡（A≤V+E_c）

争议态买方接受价阈值满足 A ≤ V+E_c；∂/∂V>0、∂/∂E_c>0；时间项以信息性回归观察（MET.5），不作通过判据。

### 3.4 对称整蛊边界（conditional）

在对称托管与机会成本近似对称时，整蛊因子 G ≤ 1；若条件不满足，G 可能 >1，但存在无量纲上界。对称性保护弱势主体，抑制低成本的掠夺性偏离。

### 3.5 变换式约束最优性（T1–T5）

通过 T1–T5（去分期/对称化/公共超时/仅金额/预先协商）将任意满足 A1–A8 的机制变换至 NAS，逐步不劣，传递性得到约束最优性。

---

## 4. 公平与可信中立（Credible Neutrality）

### 4.1 可观察的非歧视

- 算法式结算：无平台/DAO 的自由裁量；可审计日志；确定性终态。
- 开放准入：不依赖身份白名单；叠加层（KYC/SBT）为可选。

### 4.2 对称没收的条件性（声明）

Symmetric‑Forfeit 为 conditional：在对称托管/机会成本近似对称时成立；否则仅作为信息性诊断与治理输入（见 §8）。

### 4.3 分配后果与社会正当性（信息性）

观察 G 的分布与群体差异（信息性），将异常作为治理议题；保持判据与社会层响应的边界清晰（不把社会裁量塞进共识）。

---

## 5. 对照与决策支持（信息性）

- 直接支付（无机制）：缺乏事后效率保障；福利塌缩。
- 中心化托管+仲裁（类外对照）：成本构成与路径依赖；非判据。
- HTLC/状态通道：适用客观可验证/重复交互；不适于陌生方主观性交付。
- 决策树：选择 NAS/HTLC/中心化的启发式；不纳入 §6 判据集。

---

## 6. 观测与判据（唯一通过判据）

### 6.1 覆盖范围声明

本章判据仅覆盖 NAS 交易事件集合；比较表/决策树为信息性，不纳入通过判据集。

### 6.2 判据与目标

- MET.4：整蛊观测 G 的目标统计量为 P50 ≤ 1.2（唯一通过判据）。
- MET.5：阈值回归信息性记录（price ~ E_c + T_dis，记录 R²与符号方向），不纳入通过判据。

### 6.3 复现与抽样（统一口径）

1) 窗口：最近 24h；如 n<200 则扩至 7d 或至 n≥200。  
2) 抽样：连续窗口全量；如总量过大，系统抽样步长 k=⌈N/200⌉（N=窗口内 NAS 订单总数）。  
3) 单位：时间字段（含 T_dis）统一“秒”；统计以事件日志为准。  
4) 工件标识：合约地址、起止区块、参数变更交易哈希（如有）、告警与通知时间戳、通知渠道标识（优先级：消息哈希 > 渠道ID > 渠道名；介质=邮件/IM/工单之一）。

---

## 7. 实现与互操作（信息性）

### 7.1 签名定价接口清单

EIP‑712/1271 域（建议最小集）：`chainId, orderId, amountToSeller, proposer, nonce, deadline`；以“新要约+nonce 递增+deadline 过期”实现覆盖/过期；不提供链上“撤销入口”。

### 7.2 事件字段最小集

`orderId, proposer, acceptor, amountToSeller, ts`；为可审计与复现提供最小充分信息。

### 7.3 ERC‑4337/AA 与 L2/跨域

代付不改变 Pull 结算语义；L2/跨域由部署方给出 T_reorg 估计与适配说明；白皮书保持信息性边界。

---

## 8. 治理与社会层响应（信息性）

### 8.1 分群体诊断与公平性

G 的分布与分群体差异仅作为信息性诊断；当异常显著时，进入治理评审，讨论参数/限流/冷却等动作。判据仍以 MET.4（P50≤1.2）为唯一通过条件。

### 8.2 申诉与审计

外部消息系统（邮件/IM/工单之一）作为存档介质；工件标识优先级为消息哈希 > 渠道ID > 渠道名；最小披露与可解释为默认原则。

---

## 9. 运维与版本（信息性）

监测与 SLO（示例）：P99 时长≤T_due+T_rev+T_dis、结清/争议/没收率、资金滞留。三层告警与回滚的单页流程（观测→阈值→动作），与判据分离。语义版本与变更卡（SSOT=nas_spec）。

---

## 10. 路线图（信息性）

MVP：状态机完整、Pull 结算、不变量与事件最小集。强化：批量提现/自动领取/代付；资产适配与白名单。互操作与标准化：接口标准与生态协作；保持 Minimal Enshrinement。

---

## 附录 A：符号与术语

V/C/E_c/A/T_*、事件与状态、MET/GOV、命名与单位（时间统一“秒”）。

---

## 附录 B：Trace 映射（示例）

E15（Disputing→Forfeited，timeoutForfeit）→ API: `timeoutForfeit` → INV.8 → EVT: `Forfeited` → GOV: 终态分布/争议时长。

---

## 附录 C：接口与实现清单（信息性）

签名域最小集/nonce 与 deadline 作用域；事件字段最小集；nonReentrant+CEI；入口前抢占；失败重试（≤3 行流程）。

---

## 附录 D：观测与复现（信息性）

窗口/抽样/单位/工件优先级的统一口径；唯一通过判据 MET.4 与信息性回归 MET.5 的执行说明。

---

参考与语义来源：

- 规范（SSOT）：docs/zh/nas_spec.md  
- 博弈与测量：docs/zh/nas_game_theory.md

