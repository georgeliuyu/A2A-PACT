# NAS 协议博弈分析（Blade Reviewer：评审视角）—— 以规范为 SSOT，game 为参考

使用说明
- 角色：文档评审专家；输出为“最小反例/必要条件/最小验证集”。
- SSOT：`docs/zh/nesp_spec.md`；参考：`docs/zh/nesp_game_theory.md`（信息性）。

TL;DR（≤5 行）
- 均衡与活性依赖三件事：`A ≤ E` 恒真、时间窗口单调且 `D_dis` 固定、签名域可验证且不可重放。
- 任何内嵌“仲裁/声誉/表决”到状态机的改动都会破坏 SSOT 与“可信中立”。
- 观测面不足（事件缺字段/指标未版本化）将使“可证伪”失效，均衡结论不可操作。

一页表（目的/定义/假设/指标/依赖）
- 目的：在无仲裁前提下实现主观性交付的可验证结算与对称威慑。
- 定义与状态：`A ≤ E`，`D_due/D_rev` 单调、`D_dis` 固定；状态机见 SSOT §2/§7。
- 假设（可证伪式）：签名不可重放；时间源统一；金额/精度口径一致；零协议费。
- 指标：MET.1/3/4、GOV.1/2、MET.5（必须 0）。
- 依赖：EIP‑712/1271、可靠事件与回执日志。

第一性分解（必要条件/最短反例）
1) 反例：允许 `A > E` 或 `E` 可被减少 → 付款不劣（PR.1）失效 ⇒ 阻断。
2) 反例：允许延长 `D_dis` 或由外部投票决定结局 → 有限终止破坏/过载共识 ⇒ 阻断。
3) 反例：签名域缺 `orderId/nonce/deadline/chainid` → 可跨单/跨链重放 ⇒ 阻断。
4) 反例：入口直接 `transfer` → 破坏 Pull 与 CEI ⇒ 资金外泄风险。
5) 反例：事件缺 `actor/via/amount/escrow` → MET/GOV 不可复现 ⇒ 监测失效。

最小修复集（示例）
- Fix‑1：属性测试 `invariant A ≤ E(t_settle)` + 链下 Fuzz 的 `settleWithSigs` 域校验。
- Fix‑2：把 `D_dis` 从可配项改为常量或仅部署期设定，运行期不可延长；审计“所有路径”。
- Fix‑3：统一金额/时间精度与单位；ERC‑20 采用 `SafeERC20` 与向下取整。
- Fix‑4：事件补全字段与文档口径，建立指标版本（VER）。

最小验证计划
- 用例：无争议全额结清、争议签名金额、超时没收、恶意重放、脏 ERC‑20、4337/2771 代付路径。
- 阈值：MET.5=0；结清到账 P95≤3 区块；没收率区间稳定（按窗口与品类分层）。
- 观测：事件与回执采集；`A/E` 分布；失败原因归因（回滚错误码统计）。
- 回滚：超阈（SLO/安全）触发停写与白名单策略。

未决问题（信息增益排序）
- 是否需要“批量提现/自动领取”与兼容窗口？是否改变 MET 口径？
- `via` 白名单策略与 4337 EntryPoint 的配置与观测？
- 资产支持策略（非标准 ERC‑20）是否需专用事件辅助观测？

证据与引用
- SSOT：`docs/zh/nesp_spec.md` §1–§8。
- 参考：`docs/zh/nesp_game_theory.md` 的均衡/基线章节（信息性）。

互学增补（吸收其他专家要点；不改变 SSOT）
- 对 Vitalik：把“可信中立”落为可检项：零协议费（MET.5=0）、禁止内置仲裁/表决（Diff-Review 审查守卫变更）。
- 对 Glen：把 `A/E` 分布与没收率作为公平性最低观测面，强制事件字段覆盖以可复现公共审计。
- 对 Tim：以“简单且近优”为写作与评审原则：若复杂度无显著收益，提示降维与删改。
- 对 Bob：把不变量/签名域/Pull/CEI 编入“阻断清单”，配属性测试与 Fuzz 的复现实验步骤。
- 对 Nenad：对“渗透性开关”建立停写/白名单/熔断阈值，版本化指标并给回滚路径。
